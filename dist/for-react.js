var F=()=>{},d=Symbol("pulse(disposed)"),y=new Set,v=new Set,f="",b=!1,D=Date.now(),E="production";function N(t){E=t.mode}var x=class{constructor(e){this.callback=e}register(e,s){}unregister(e){}},z=globalThis.FinalizationRegistry||x,r={byId:new Map,gc:{get alive(){return r.gc.created-r.gc.finalized},get active(){return r.gc.created-r.gc.disposed},created:0,disposed:0,finalized:0,watcher:new z(t=>{r.gc.finalized=r.gc.finalized+1})},track(t){E==="debug"&&(r.byId.set(t.id,t),r.gc.watcher.register(t,t.id),r.gc.created=r.gc.created+1)},untrack(t){E==="debug"&&(r.byId.delete(t.id),r.gc.disposed=r.gc.disposed+1,r.gc.watcher instanceof x&&r.gc.watcher.callback(t.id))}};function V(t,e){let s=f;f=t+"_";let i=e();return f=s,i}function h(){return(D++).toString(36)}var M=t=>t instanceof p,Q=t=>t instanceof g,j=t=>t instanceof u;function L(){y.forEach(t=>{t()}),y.clear()}function B(){v.forEach(t=>{t()}),v.clear()}function I(...t){t.forEach(e=>{"dispose"in e?e.dispose():console.error("Cannot dispose",e)})}var a=class t{constructor(e,s){this.listener=e;this.callback=s}static current=null;static run(e,s){let i=new t(e,s),n=t.current;t.current=i,s(),t.current=n}};function P(t,e){t._signals.add(e)}function R(t,e,s=!1){t._signals.delete(e),s&&t.dispose()}function O(t,e){t._listeners.add(e)}function m(t,e,s){t._listeners.delete(e)}function K(t){t._notify()}var p=class{id=f+"S"+h();_value;_listeners=new Set;constructor(e){this._value=e,r.track(this)}peek(){return this._value}get=()=>{if(this._value===d)throw new Error("Signal is disposed");return a.current&&(O(this,a.current.listener),P(a.current.listener,this)),this._value};set(e,s=!1){return this._value!==e||s?(this._value=e,this._value===d?(this._listeners.forEach(i=>{R(i,this,!0)}),this._listeners.clear(),r.untrack(this),!1):(b?v.add(this._notify):(this._notify(),L()),!0)):!1}subscribe(e){return new u(()=>{e(this.get())})}dispose=()=>{this._value!==d&&this.set(d)};_notify=()=>{this._listeners.forEach(e=>{K(e)})};static internals(e){return{signal:e,_value:e._value,_listeners:e._listeners}}},g=class{constructor(e){this._fn=e;r.track(this)}id=f+"C"+h();_value;_isStale=!0;_signals=new Set;_listeners=new Set;peek(){return this._value}get=()=>{if(this._value===d)throw new Error("Computed is disposed");return this._isStale&&(this._signals.forEach(e=>{m(e,this)}),this._signals.clear(),a.current&&(O(this,a.current.listener),P(a.current.listener,this)),a.run(this,()=>{this._derive()})),this._value};subscribe(e){return new u(()=>{e(this.get())})}dispose=()=>{this._value!==d&&(this._listeners.forEach(e=>{R(e,this,!0)}),this._listeners.clear(),this._signals.forEach(e=>{m(e,this,!0)}),this._signals.clear(),this._value=d,r.untrack(this))};_derive(){this._value=this._fn(),this._isStale=!1}_notify(){this._isStale||(this._isStale=!0,this._listeners.forEach(e=>{K(e)}))}static internals(e){return{computed:e,_value:e._value,_isStale:e._isStale,_signals:e._signals,_listeners:e._listeners}}},u=class{constructor(e){this._fn=e;r.track(this),this._run()}id=f+"E"+h();_signals=new Set;_isStale=!0;_isDisposed=!1;_dispose=F;_run=()=>{if(this._isDisposed)return console.warn("Effect run skipped due to disposed");this._isStale&&(this._signals.forEach(e=>{m(e,this)}),this._signals.clear(),a.run(this,()=>{this._dispose=this._fn()||this._dispose})),this._isStale=!1};_notify(){this._isDisposed||this._isStale||(this._isStale=!0,y.add(this._run))}dispose=()=>{this._isDisposed||(this._isDisposed=!0,this._dispose(),this._signals.forEach(e=>{m(e,this,!0)}),this._signals.clear(),r.untrack(this))};static internals(e){return{effect:e,_signals:e._signals,_isStale:e._isStale,_isDisposed:e._isDisposed,_innerDispose:e._dispose}}};function U(t){b=!0;try{return t()}finally{b=!1,B(),L()}}function _(t){return new p(t)}function k(t){return new g(t)}function w(t){return new u(t)}globalThis._pulse_={devTools:r,internals:{effectQueue:y,batchedUpdateQueue:v,get inBatch(){return b},get lastUid(){return D},get _idPrefx(){return f}},dispose:I,Signal:p,Computed:g,Effect:u,batch:U,signal:_,computed:k,effect:w};var J={storage:globalThis.localStorage,toStorage:JSON.stringify,fromStorage:JSON.parse};function ee(t,e,s){let{storage:i,toStorage:n,fromStorage:c}={...J,...s};if(!i)return console.warn("No storage available, using regular signal",t),_(e);let o=i.getItem(t),l=_(o?c(o):e);return l.subscribe(S=>{i.setItem(t,n(S))}),l}function te(t,e,s=!1){let i=t.peek(),n=typeof e=="function"?e(i):e;if(typeof n!="object"||n===null)return t.set(n);{let o={...i,...n};return t.set(o),s?W(i,o):!0}}function W(t,e){let s=Reflect.ownKeys(t),i=Reflect.ownKeys(e),n=i.filter(l=>!s.includes(l)),c=s.filter(l=>!i.includes(l)),o=s.filter(l=>t[l]!==e[l]);return[...n,...c,...o]}import{createElement as q,useEffect as T,useMemo as A,useState as C}from"react";function ce(t){let e=A(()=>k(t),[]);return T(()=>()=>e.dispose(),[e]),G(e)}function ue(t){T(()=>{let e=w(()=>t());return()=>e.dispose()},[])}function G(t){let[e,s]=C(()=>t.peek());return T(()=>{let i=t.subscribe(n=>{s(n)});return()=>i.dispose()},[t]),e}function de(...t){let[e,s]=C(()=>t.map(i=>i.peek()));return T(()=>{let i=t.map((n,c)=>n.subscribe(o=>{s(l=>{let S=l.slice();return S[c]=o,S})}));return()=>{i.forEach(n=>n.dispose())}},t),e}function fe(t){return function(s){let[i,n]=C({});return T(()=>{function c(){return a.run({id:"TC"+h(),_signalChanged(){n({})},_trackSignal(){},_untrackSignal(){},dispose(){}},()=>{t(s)}),()=>{}}let o=c();return()=>{o()}},[t,s]),q(t,s)}}export{g as Computed,u as Effect,p as Signal,U as batch,k as computed,N as config,r as devTools,I as dispose,w as effect,Q as isComputed,j as isEffect,M as isSignal,ee as persistedSignal,_ as signal,te as update,ce as useComputed,ue as useSignalEffect,G as useSignalValue,de as useSignalValues,V as withIdPrefix,fe as withSignalTracking};
