var i=null;function h(){return i}function f(e){i=e}var o=[],a=!1,l=new Set,u=class{_value;subscribers=new Set;dependents=new Set;constructor(n){this._value=n}get value(){return i&&(this.dependents.add(i),i.dependencies.add(this)),this._value}set value(n){this._value!==n&&(this._value=n,new Set(this.dependents).forEach(s=>s.invalidate()),this.subscribers.forEach(s=>s(n)))}peek(){return this._value}get(){return this.value}set(n){this.value=n}update(n){this.set(n(this._value))}subscribe(n){return n(this._value),this.subscribers.add(n),()=>{this.subscribers.delete(n)}}},p=1;var r=class{id=p++;fn;dependencies=new Set;isRunning=!1;isCleaning=!1;onInnerCleanup=void 0;onInvalidate=null;parentComputation;childComputations=new Set;constructor(n,t=null){this.fn=n,this.parentComputation=t,this.run()}run(){if(!this.isRunning){this.cleanup(!1),o.push(this),i=this;try{this.isRunning=!0;let n=this.fn();typeof n=="function"?this.onInnerCleanup=n:this.onInnerCleanup=void 0}finally{this.isRunning=!1,o.pop(),i=o[o.length-1]||null}}}invalidate(){a?l.add(this):this.onInvalidate?this.onInvalidate():this.run()}cleanup(n=!0){this.isCleaning||(this.isCleaning=!0,Array.from(this.childComputations).forEach(t=>{t.cleanup()}),this.onInnerCleanup&&(this.onInnerCleanup(),this.onInnerCleanup=void 0),this.dependencies.forEach(t=>t.dependents.delete(this)),this.dependencies.clear(),this.parentComputation&&n&&this.parentComputation.childComputations.delete(this),this.isCleaning=!1)}},c=class{signal;cleanup;constructor(n){this.signal=new u(void 0),this.cleanup=d(()=>{this.signal.value=n()})}get value(){return this.signal.value}peek(){return this.signal.peek()}get(){return this.signal.get()}subscribe(n){return this.signal.subscribe(n)}};function v(e){return new u(e)}function d(e){let n=i,t=new r(e,n);return n&&n.childComputations.add(t),()=>t.cleanup()}function g(e){return new c(e)}function C(e){let n=a;a=!0;try{e()}finally{if(a=n,!a){let t=Array.from(l);l.clear(),t.forEach(s=>s.run())}}}function T(e){return typeof e=="object"&&e!==null&&"get"in e&&"peek"in e&&"subscribe"in e}export{h as a,f as b,u as c,r as d,v as e,d as f,g,C as h,T as i};
